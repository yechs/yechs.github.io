<!doctype html>
<html lang="zh-Hans" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.6">
<link rel="alternate" type="application/rss+xml" href="/zh-Hans/blog/rss.xml" title="Ye Shu Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/zh-Hans/blog/atom.xml" title="Ye Shu Blog Atom Feed">
<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-M3X8PGC98D"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-M3X8PGC98D",{})</script>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.13.11/dist/katex.min.css" integrity="sha384-Um5gpz1odJg5Z4HAmzPtgZKdTBHZdw8S29IecapCSB31ligYPhHQZMIlWLYQGVoc" crossorigin="anonymous"><title data-react-helmet="true">å†…å­˜æ³„æ¼ ä¸ malloc chunk | Ye Shu</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://shuye.dev/zh-Hans/blog/malloc_chunk"><meta data-react-helmet="true" name="docusaurus_locale" content="zh-Hans"><meta data-react-helmet="true" name="docusaurus_tag" content="default"><meta data-react-helmet="true" property="og:title" content="å†…å­˜æ³„æ¼ ä¸ malloc chunk | Ye Shu"><meta data-react-helmet="true" name="description" content="æˆ‘ä¸ºä»€ä¹ˆå†™è¿™ç¯‡æ–‡ç« "><meta data-react-helmet="true" property="og:description" content="æˆ‘ä¸ºä»€ä¹ˆå†™è¿™ç¯‡æ–‡ç« "><meta data-react-helmet="true" property="og:image" content="https://shuye.dev/img/yechs.jpeg"><meta data-react-helmet="true" name="twitter:image" content="https://shuye.dev/img/yechs.jpeg"><meta data-react-helmet="true" property="og:type" content="article"><meta data-react-helmet="true" property="article:published_time" content="2021-08-13T00:00:00.000Z"><meta data-react-helmet="true" property="article:author" content="https://github.com/yechs"><meta data-react-helmet="true" property="article:tag" content="c++,pwn"><link data-react-helmet="true" rel="shortcut icon" href="/zh-Hans/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://shuye.dev/zh-Hans/blog/malloc_chunk"><link data-react-helmet="true" rel="alternate" href="https://shuye.dev/blog/malloc_chunk" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://shuye.dev/zh-Hans/blog/malloc_chunk" hreflang="zh-Hans"><link data-react-helmet="true" rel="alternate" href="https://shuye.dev/blog/malloc_chunk" hreflang="x-default"><link rel="stylesheet" href="/zh-Hans/assets/css/styles.2e558cc8.css">
<link rel="preload" href="/zh-Hans/assets/js/runtime~main.02f4c884.js" as="script">
<link rel="preload" href="/zh-Hans/assets/js/main.2b80505b.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_1oUP">è·³åˆ°ä¸»è¦å†…å®¹</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/zh-Hans/"><img src="/zh-Hans/img/yechs.jpeg" alt="Ye Shu" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/zh-Hans/img/yechs.jpeg" alt="Ye Shu" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><b class="navbar__title">@yechs</b></a><a class="navbar__item navbar__link" href="/zh-Hans/kb/intro">çŸ¥è¯†åº“</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/zh-Hans/blog">åšå®¢</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/yechs" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><a href="https://www.linkedin.com/in/yechs/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>LinkedIn<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" class="navbar__link"><span><svg viewBox="0 0 20 20" width="20" height="20" aria-hidden="true" class="iconLanguage_3vod"><path fill="currentColor" d="M19.753 10.909c-.624-1.707-2.366-2.726-4.661-2.726-.09 0-.176.002-.262.006l-.016-2.063 3.525-.607c.115-.019.133-.119.109-.231-.023-.111-.167-.883-.188-.976-.027-.131-.102-.127-.207-.109-.104.018-3.25.461-3.25.461l-.013-2.078c-.001-.125-.069-.158-.194-.156l-1.025.016c-.105.002-.164.049-.162.148l.033 2.307s-3.061.527-3.144.543c-.084.014-.17.053-.151.143.019.09.19 1.094.208 1.172.018.08.072.129.188.107l2.924-.504.035 2.018c-1.077.281-1.801.824-2.256 1.303-.768.807-1.207 1.887-1.207 2.963 0 1.586.971 2.529 2.328 2.695 3.162.387 5.119-3.06 5.769-4.715 1.097 1.506.256 4.354-2.094 5.98-.043.029-.098.129-.033.207l.619.756c.08.096.206.059.256.023 2.51-1.73 3.661-4.515 2.869-6.683zm-7.386 3.188c-.966-.121-.944-.914-.944-1.453 0-.773.327-1.58.876-2.156a3.21 3.21 0 011.229-.799l.082 4.277a2.773 2.773 0 01-1.243.131zm2.427-.553l.046-4.109c.084-.004.166-.01.252-.01.773 0 1.494.145 1.885.361.391.217-1.023 2.713-2.183 3.758zm-8.95-7.668a.196.196 0 00-.196-.145h-1.95a.194.194 0 00-.194.144L.008 16.916c-.017.051-.011.076.062.076h1.733c.075 0 .099-.023.114-.072l1.008-3.318h3.496l1.008 3.318c.016.049.039.072.113.072h1.734c.072 0 .078-.025.062-.076-.014-.05-3.083-9.741-3.494-11.04zm-2.618 6.318l1.447-5.25 1.447 5.25H3.226z"></path></svg><span>ç®€ä½“ä¸­æ–‡</span></span></a><ul class="dropdown__menu"><li><a href="/blog/malloc_chunk" target="_self" rel="noopener noreferrer" class="dropdown__link" style="text-transform:capitalize">English</a></li><li><a href="/zh-Hans/blog/malloc_chunk" target="_self" rel="noopener noreferrer" class="dropdown__link dropdown__link--active" style="text-transform:capitalize">ç®€ä½“ä¸­æ–‡</a></li></ul></div><div class="react-toggle toggle_3Zt9 react-toggle--disabled"><div class="react-toggle-track" role="button" tabindex="-1"><div class="react-toggle-track-check"><span class="toggle_71bT">ğŸŒœ</span></div><div class="react-toggle-track-x"><span class="toggle_71bT">ğŸŒ</span></div><div class="react-toggle-thumb"></div></div><input type="checkbox" class="react-toggle-screenreader-only" aria-label="Switch between dark and light mode"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper blog-wrapper blog-post-page"><div class="container margin-vert--lg"><div class="row"><aside class="col col--3"><nav class="sidebar_2ahu thin-scrollbar" aria-label="Blog recent posts navigation"><div class="sidebarItemTitle_2hhb margin-bottom--md">Recent Posts</div><ul class="sidebarItemList_2xAf"><li class="sidebarItem_2UVv"><a aria-current="page" class="sidebarItemLink_1RT6 sidebarItemLinkActive_12pM" href="/zh-Hans/blog/malloc_chunk">å†…å­˜æ³„æ¼ ä¸ malloc chunk</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/zh-Hans/blog/welcome">Me and My Broken Site(s)</a></li></ul></nav></aside><main class="col col--7" itemscope="" itemtype="http://schema.org/Blog"><article itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h1 class="blogPostTitle_GeHD" itemprop="headline">å†…å­˜æ³„æ¼ ä¸ malloc chunk</h1><div class="blogPostData_291c margin-vert--md"><time datetime="2021-08-13T00:00:00.000Z" itemprop="datePublished">2021å¹´8æœˆ13æ—¥</time> Â· 10 åˆ†é’Ÿé˜…è¯»</div><div class="row margin-top--md margin-bottom--sm"><div class="col col--6 authorCol_1R69"><div class="avatar margin-bottom--sm"><a href="https://github.com/yechs" target="_blank" rel="noopener noreferrer" class="avatar__photo-link avatar__photo"><img class="image_1yU8" src="https://avatars.githubusercontent.com/u/49149993" alt="Ye Shu"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://github.com/yechs" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">Ye Shu</span></a></div><small class="avatar__subtitle" itemprop="description">Studying how C++ allocates and frees chunks in memory</small></div></div></div></div></header><meta itemprop="image" content="https://shuye.dev/img/yechs.jpeg"><div class="markdown" itemprop="articleBody"><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="how-it-all-started"></a>æˆ‘ä¸ºä»€ä¹ˆå†™è¿™ç¯‡æ–‡ç« <a class="hash-link" href="#how-it-all-started" title="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥">#</a></h2><p>åœ¨æˆ‘æš‘æœŸå®ä¹ æœŸé—´ debug ä¸€ä¸ªå†…å­˜æ³„æ¼çš„é—®é¢˜æ—¶ï¼Œæˆ‘å‘ç°æˆ‘ä½¿ç”¨çš„å…¶ä¸­ä¸€ä¸ª API return äº†ä¸€ä¸ªè£¸æŒ‡é’ˆï¼Œä»è€ŒæŠŠè¿™ä¸ªç›®æ ‡çš„ ownership è½¬ç§»ç»™äº†è°ƒç”¨è€…ï¼ˆæˆ‘ï¼‰ã€‚æ¢è¨€ä¹‹ï¼Œæˆ‘ç°åœ¨éœ€è¦è´Ÿè´£åœ¨ä»£ç è¿è¡Œå®Œæ¯•ä¹‹åæ‰‹åŠ¨ <code>delete</code> æ‰è¿™ä¸ªæŒ‡é’ˆã€‚å°½ç®¡è¿™æ˜¯ä¸€ä¸ª <a href="https://isocpp.github.io/CppCoreGuidelines/CppCoreGuidelines#i11-never-transfer-ownership-by-a-raw-pointer-t-or-reference-t" target="_blank" rel="noopener noreferrer">éå¸¸ç³Ÿç³•çš„å·¥ç¨‹å®è·µ</a>ï¼Œæˆ‘å¼€å§‹å¯¹å†…å­˜æ³„æ¼æ˜¯å¦‚ä½•äº§ç”Ÿçš„ï¼Œä»¥åŠ <code>delete[]</code> æ˜¯å¦‚ä½•åˆ é™¤å†…å­˜çš„äº§ç”Ÿäº†å…´è¶£ã€‚</p><p>åœ¨åšäº†ä¸€äº›ç ”ç©¶ä¸å®éªŒåï¼Œæˆ‘å†™ä¸‹äº†è¿™ç¯‡æ–‡ç« ã€‚æœ¬æ–‡å°†è¯•å›¾å›ç­”ä¸‰ç»„é—®é¢˜ï¼š</p><ol><li>ä»€ä¹ˆæ˜¯å†…å­˜æ³„æ¼ï¼Ÿ</li><li>å¯¹è±¡æ˜¯å¦‚ä½•åœ¨ å † (heap) ä¸Šè¢«åˆ†é…çš„ï¼Ÿ<code>delete[]</code> å¦‚ä½•çŸ¥é“å®ƒéœ€è¦é‡Šæ”¾å“ªå—å†…å­˜ï¼Ÿ</li><li>æˆ‘ä»¬å¦‚ä½•é¢„é˜²å†…å­˜æ³„æ¼ï¼Ÿ</li></ol><p>Stack Overflow ä¸Šçš„é—®é¢˜ <a href="https://stackoverflow.com/questions/197675/how-does-delete-know-the-size-of-the-operand-array" target="_blank" rel="noopener noreferrer">&quot;How does delete[] &#x27;know&#x27; the size of the operand array?&quot;</a> å…¶å®å·²ç»å¤§è‡´å›ç­”äº†æˆ‘ä»¬çš„ç¬¬äºŒä¸ªé—®é¢˜ï¼Œä½†æˆ‘è¿˜æ˜¯å†³å®šæ›´æ·±å…¥åœ°æ¢è®¨ä¸€ä¸‹å®é™…çš„å†…å­˜ç©ºé—´æ˜¯ä»€ä¹ˆæ ·çš„ã€‚</p><p>å·§åˆçš„æ˜¯ï¼Œæˆ‘å’Œæœ‹å‹ <a href="https://guozhen.dev" target="_blank" rel="noopener noreferrer">@gzhding</a> åˆšå¥½åœ¨æœ€è¿‘çš„ä¸€æ¬¡ CTF æ¯”èµ›ä¸­åˆä½œäº†ä¸€é“ å †åˆ©ç”¨ (heap exploitation) çš„é¢˜ç›®ã€‚å› ä¸ºè¿™ä»½ç»å†ï¼Œæˆ‘å­¦ä¼šäº†å¦‚ä½•ä½¿ç”¨ <code>gdb</code> è°ƒè¯•å¹¶æŸ¥çœ‹å †ä¸Šçš„å†…å­˜ï¼Œä»¥å€Ÿå…¶ç®¡ä¸­çª¥è±¹ã€‚</p><div class="admonition admonition-info alert alert--info"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</h5></div><div class="admonition-content"><p>æ³¨ï¼šæˆ‘å…ˆå†™æˆäº†æœ¬æ–‡çš„è‹±æ–‡ç‰ˆï¼Œä¹‹åæ‰è¯•å›¾å°†å…¶è¯‘å›ä¸­æ–‡ã€‚å› æ­¤å¦‚æœ‰å¯èƒ½çš„è¯ï¼Œè¯·<a href="https://shuye.dev/blog/malloc_chunk/" target="_blank" rel="noopener noreferrer">ä»¥è‹±æ–‡é˜…è¯»æœ¬æ–‡</a>ï¼Œä»¥é¿å…ä¸€äº›å› ä¸ºç¿»è¯‘è´¨é‡å¯¼è‡´çš„è¯­å¥ä¸é¡ºä¸ç†è§£å›°éš¾ã€‚</p></div></div><div class="tocCollapsible_1PrD"><button type="button" class="clean-btn tocCollapsibleButton_2O1e">æœ¬é¡µæ€»è§ˆ</button></div><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="what-are-memory-leaks"></a>ä»€ä¹ˆæ˜¯å†…å­˜æ³„æ¼<a class="hash-link" href="#what-are-memory-leaks" title="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥">#</a></h2><p>æˆ‘ä»¬çŸ¥é“ <a href="https://www.cplusplus.com/doc/tutorial/dynamic/" target="_blank" rel="noopener noreferrer">C++ èƒ½å¤Ÿåœ¨å †ä¸ŠåŠ¨æ€åœ°åˆ†é…å†…å­˜</a>ã€‚ä¸€ä¸ªå¸¸è§çš„ä¾‹å­æ˜¯ä½¿ç”¨ <code>new[]</code> åˆ›å»ºæ•°ç»„ï¼Œä»¥åŠ <code>delete[]</code> åˆ é™¤æ•°ç»„ã€‚</p><p>å½“æˆ‘ä»¬åœ¨å†…å­˜ä¸­åˆ›å»ºäº†ä¸€ä¸ªæ•°ç»„ï¼ˆå³åˆ†é…äº†ä¸€æ®µå†…å­˜ç”¨ä»¥å­˜å‚¨è¿™ä¸ªå¯¹è±¡ï¼‰è€Œåˆå¿˜è®°åˆ é™¤å®ƒæ—¶ï¼Œ<a href="https://en.wikipedia.org/wiki/Memory_leak" target="_blank" rel="noopener noreferrer">å†…å­˜æ³„æ¼</a> å°±ä¼šå‘ç”Ÿã€‚å½“æŒ‡å‘è¿™æ®µå†…å­˜çš„æŒ‡é’ˆè¶…å‡ºä½œç”¨åŸŸ (scope) æ—¶ï¼Œæ­£åœ¨è¿è¡Œçš„ä»£ç å°±ä¸¢å¤±äº†å¯¹è¢«åˆ†é…çš„å†…å­˜çš„çŸ¥è¯†ã€‚åœ¨æœ€åçš„æƒ…å†µä¸‹ï¼Œå¦‚æœå†…å­˜æ³„æ¼åœ¨ä¸€ä¸ªå¾ªç¯ä¸­å‘ç”Ÿï¼Œæ–°åˆ†é…çš„å†…å­˜èƒ½å¤ŸæŒç»­åœ°å †ç§¯è€Œä¸è¢«é‡Šæ”¾ï¼Œæœ€ç»ˆä½¿å¾—ç”µè„‘å˜æ…¢ç”šè‡³å´©æºƒã€‚</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="poc"></a>PoC<a class="hash-link" href="#poc" title="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥">#</a></h3><p>ä»¥ä¸‹æœ‰ä¸€æ®µç®€å•çš„ Proof of Concept (PoC) ä»£ç ã€‚å…¶ä¸­çš„ <code>main()</code> å‡½æ•°è°ƒç”¨äº† <code>memory_leak()</code> å‡½æ•°ï¼Œåè€…åˆåˆ›å»ºäº†ä¸€ä¸ªç”± 26 ä¸ª <code>char</code> ç»„æˆçš„æ•°ç»„ï¼Œå¹¶å°†å¤§å†™è‹±æ–‡å­—æ¯å¡«å…¥å®ƒä»¬ã€‚</p><div class="codeBlockContainer_K1bP"><div style="color:#bfc7d5;background-color:#292d3e" class="codeBlockTitle_eoMF">memory_leak.cpp</div><div class="codeBlockContent_hGly cpp"><pre tabindex="0" class="prism-code language-cpp codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">memory_leak</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// Always delete pointers created by new to avoid memory leaks!</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">char</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain">arr </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">new</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">char</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token number" style="color:rgb(247, 140, 108)">26</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">for</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">int</span><span class="token plain"> i </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"> i </span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">26</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"> i</span><span class="token operator" style="color:rgb(137, 221, 255)">++</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        arr</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain">i</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">char</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">65</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">+</span><span class="token plain"> i</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"> </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// 65 is the ascii of &#x27;A&#x27;</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// The memory area is not freed!</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// delete[] arr;</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">int</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">main</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token function" style="color:rgb(130, 170, 255)">memory_leak</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">return</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span></span></code></pre><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" class="copyButton_Ue-o clean-btn">å¤åˆ¶</button></div></div><p>å› ä¸º <code>delete[]</code> è¯­å¥å·²ç»è¢«æ³¨é‡Šæ‰ï¼Œå½“å‡½æ•° <code>memory_leak()</code> return æ—¶ï¼ŒæŒ‡é’ˆ <code>arr</code> ä¼šè¶…å‡ºä½œç”¨åŸŸ (scope) å¹¶å¯¼è‡´è¿™ä¸€å†…å­˜åŒºåŸŸè¢«æ³„æ¼ã€‚</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="a-deeper-look-into-the-memory"></a>åˆæ¢å†…å­˜<a class="hash-link" href="#a-deeper-look-into-the-memory" title="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥">#</a></h3><div class="admonition admonition-note alert alert--secondary"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</h5></div><div class="admonition-content"><p>æˆ‘ä½¿ç”¨äº† <a href="https://github.com/hugsy/gef" target="_blank" rel="noopener noreferrer">GEF</a> (GDB Enhanced Features) è€Œä¸æ˜¯åŸç”Ÿ GDB ä»¥è·å–ç»è¿‡ç¾åŒ–çš„è¾“å‡ºä»¥åŠè¯¸å¦‚ <code>heap</code> ä¸€ç±»çš„é¢å¤–åŠŸèƒ½ã€‚</p></div></div><p>è®©æˆ‘ä»¬ä»¥ <code>g++ -g3 memory_leak.cpp -o memory_leak</code> æ¥ç¼–è¯‘è¿™ä¸ªç¨‹åºï¼ˆ<code>-g3</code> flag ä¼šåœ¨ç¼–è¯‘æ—¶ä¿å­˜ç¨‹åºçš„è°ƒè¯•ä¿¡æ¯ï¼‰å¹¶ä½¿ç”¨ <code>gdb</code> æ¥éªŒè¯è¿™ä¸€å†…å­˜æ³„æ¼ã€‚</p><p>æˆ‘ä»¬å°†ä¼šåœ¨ <code>memory_leak()</code> å‡½æ•°çš„æœ€åæ‰“ä¸€ä¸ªæ–­ç‚¹ï¼Œå¹¶è¿è¡Œç¨‹åºç›´åˆ°å…¶è§¦å‘æ–­ç‚¹ã€‚</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly console"><pre tabindex="0" class="prism-code language-console codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ gdb memory_leak</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">gefâ¤  b 11</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Breakpoint 1 at 0x1179: file memory_leak.cpp, line 11.</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">gefâ¤  r</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">[...]</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ source:memory_leak.cpp+11 â”€â”€â”€â”€</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      6          arr[i] = char(65 + i); // 65 is the ascii of &#x27;A&#x27;</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      7      }</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      8</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      9      // The memory area is not freed!</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">     10      // delete[] arr;</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">â—â†’   11  }</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">     12</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">     13  int main() {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">     14      memory_leak();</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">     15      return 0;</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">     16  }</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ threads â”€â”€â”€â”€</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">[#0] Id 1, Name: &quot;memory_leak&quot;, stopped 0x555555555179 in memory_leak (), reason: BREAKPOINT</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ trace â”€â”€â”€â”€</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">[#0] 0x555555555179 â†’ memory_leak()</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">[#1] 0x555555555186 â†’ main()</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">gefâ¤  info locals</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">arr = 0x55555556aeb0 &quot;ABCDEFGHIJKLMNOPQRSTUVWXYZ&quot;</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">gefâ¤  x/8xw 0x55555556aeb0</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">0x55555556aeb0: 0x44434241      0x48474645      0x4c4b4a49      0x504f4e4d</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">0x55555556aec0: 0x54535251      0x58575655      0x00005a59      0x00000000</span></span></code></pre><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" class="copyButton_Ue-o clean-btn">å¤åˆ¶</button></div></div><p>åœ¨ç¨‹åºè§¦å‘æ–­ç‚¹åï¼Œæˆ‘ä»¬æ‰“å°å‡ºæŒ‡é’ˆ <code>arr</code> æŒ‡å‘çš„åœ°å€åŠè¿™å—å†…å­˜çš„å†…å®¹ã€‚æ³¨æ„å†…å­˜æ˜¯ä»¥ <a href="https://zh.wikipedia.org/zh-cn/%E5%AD%97%E8%8A%82%E5%BA%8F#%E5%B0%8F%E7%AB%AF%E5%BA%8F" target="_blank" rel="noopener noreferrer">å°ç«¯åº</a> å­˜å‚¨çš„ï¼Œå› æ­¤ <code>0x44</code> (D) æ’åœ¨ <code>0x43</code> (C)ï¼Œ<code>0x42</code> (B)ï¼Œä»¥åŠ <code>0x41</code> (A) ä¹‹å‰ã€‚</p><p>ç°åœ¨ï¼Œè®©æˆ‘ä»¬ç»§ç»­è¿è¡Œè¿™ä¸ªç¨‹åºï¼Œç›´åˆ°å‡½æ•° <code>memory_leak()</code> è¿è¡Œå®Œæ¯•è¿”å›è‡³ <code>main()</code>ã€‚</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly gdb"><pre tabindex="0" class="prism-code language-gdb codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">gefâ¤  finish</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">[...]</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ source:memory_leak.cpp+15 â”€â”€â”€â”€</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">     10      // delete[] arr;</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">â—    11  }</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">     12</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">     13  int main() {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">     14      memory_leak();</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> â†’   15      return 0;</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">     16  }</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ threads â”€â”€â”€â”€</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">[#0] Id 1, Name: &quot;memory_leak&quot;, stopped 0x555555555186 in main (), reason: TEMPORARY BREAKPOINT</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ trace â”€â”€â”€â”€</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">[#0] 0x555555555186 â†’ main()</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">gefâ¤  info locals</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">No locals.</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">gefâ¤  x/8xw 0x55555556aeb0</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">0x55555556aeb0: 0x44434241      0x48474645      0x4c4b4a49      0x504f4e4d</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">0x55555556aec0: 0x54535251      0x58575655      0x00005a59      0x00000000</span></span></code></pre><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" class="copyButton_Ue-o clean-btn">å¤åˆ¶</button></div></div><p>æ—¢ç„¶ <code>memory_leak()</code> return äº†ï¼Œæˆ‘ä»¬å°±ä¸¢å¤±äº†æŒ‡å‘å†…å­˜åœ°å€ <code>0x55555556aeb0</code> çš„æŒ‡é’ˆ <code>arr</code>ã€‚ä½†å½“æˆ‘ä»¬æ‰“å°å‡ºå†…å­˜åŒºåŸŸæ—¶ï¼Œå‘ç°è¿™äº›æ•°æ®ä»ç„¶å­˜å‚¨åœ¨å†…å­˜ä¸­ï¼Œæ²¡æœ‰ï¼ˆä¹Ÿä¸ä¼šï¼‰è¢«é‡Šæ”¾ã€‚è¿™å°±æ˜¯å†…å­˜æ³„æ¼ã€‚</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="verification-with-valgrind"></a>åˆ©ç”¨ Valgrind è¿›è¡ŒéªŒè¯<a class="hash-link" href="#verification-with-valgrind" title="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥">#</a></h3><p>æ­¤å¤–ï¼Œæˆ‘ä»¬èƒ½å¤Ÿä½¿ç”¨å¦‚ <a href="https://valgrind.org" target="_blank" rel="noopener noreferrer">Valgrind</a> ä¸€æ ·çš„è‡ªåŠ¨åŒ–å·¥å…·æ¥æ£€æŸ¥å†…å­˜æ³„æ¼ã€‚</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly console"><pre tabindex="0" class="prism-code language-console codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ valgrind --leak-check=full ./memory_leak</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">==382643== Memcheck, a memory error detector</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">==382643== Copyright (C) 2002-2017, and GNU GPL&#x27;d, by Julian Seward et al.</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">==382643== Using Valgrind-3.17.0 and LibVEX; rerun with -h for copyright info</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">==382643== Command: ./memory_leak</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">==382643==</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">==382643==</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">==382643== HEAP SUMMARY:</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">==382643==     in use at exit: 26 bytes in 1 blocks</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">==382643==   total heap usage: 2 allocs, 1 frees, 72,730 bytes allocated</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">==382643==</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">==382643== 26 bytes in 1 blocks are definitely lost in loss record 1 of 1</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">==382643==    at 0x484021F: operator new[](unsigned long) (vg_replace_malloc.c:579)</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">==382643==    by 0x10914A: memory_leak() (memory_leak.cpp:3)</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">==382643==    by 0x109185: main (memory_leak.cpp:14)</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">==382643==</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">==382643== LEAK SUMMARY:</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">==382643==    definitely lost: 26 bytes in 1 blocks</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">==382643==    indirectly lost: 0 bytes in 0 blocks</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">==382643==      possibly lost: 0 bytes in 0 blocks</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">==382643==    still reachable: 0 bytes in 0 blocks</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">==382643==         suppressed: 0 bytes in 0 blocks</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">==382643==</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">==382643== For lists of detected and suppressed errors, rerun with: -s</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">==382643== ERROR SUMMARY: 1 errors from 1 contexts (suppressed: 0 from 0)</span></span></code></pre><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" class="copyButton_Ue-o clean-btn">å¤åˆ¶</button></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="how-are-objects-allocated-on-the-heap"></a>å¯¹è±¡æ˜¯å¦‚ä½•åœ¨å † (heap) ä¸Šè¢«åˆ†é…çš„<a class="hash-link" href="#how-are-objects-allocated-on-the-heap" title="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥">#</a></h2><p>ä¸ºäº†æ›´å¥½åœ°ç†è§£å†…å­˜æ³„æ¼èƒŒåçš„æœºåˆ¶ï¼Œæˆ‘ä»¬éœ€è¦äº†è§£ C++ æ˜¯å¦‚ä½•åˆ†é…ä»¥åŠé‡Šæ”¾å†…å­˜çš„ã€‚æ¢è¨€ä¹‹ï¼Œ<code>new</code> ä¸ <code>delete</code> æ˜¯å¦‚ä½•å·¥ä½œçš„ã€‚è®©æˆ‘ä»¬ä¸€èµ·æ·±å…¥è¿› GNU çš„ <code>libstdc++</code> å®ç°ï¼ˆg++ é»˜è®¤ä½¿ç”¨çš„åº“ï¼‰çš„æºç ã€‚</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="how-new-and-delete-works"></a><code>new</code> ä¸ <code>delete</code> æ˜¯å¦‚ä½•å·¥ä½œçš„<a class="hash-link" href="#how-new-and-delete-works" title="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥">#</a></h3><div class="admonition admonition-info alert alert--info"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</h5></div><div class="admonition-content"><p>å› ä¸º <code>new</code> ä¸ <code>delete</code> æ“ä½œç¬¦ä»…ä»…æ˜¯ C++ æ ‡å‡†ä¸­å®šä¹‰çš„ interfaceï¼Œå®ƒä»¬æ‹¥æœ‰ä¸åŒçš„å®ç°ã€‚æˆ‘åœ¨æ­¤å¤„å°†ä½¿ç”¨ GNU åœ¨ gcc 11.2 ç‰ˆæœ¬ä¸­æä¾›çš„ <code>libstdc++</code> çš„ <a href="https://github.com/gcc-mirror/gcc/tree/releases/gcc-11.2.0" target="_blank" rel="noopener noreferrer">æºç </a>ã€‚</p></div></div><h4><a aria-hidden="true" tabindex="-1" class="anchor anchor__h4 anchorWithStickyNavbar_31ik" id="new-and-delete-are-just-wrappers-of-new-and-delete"></a><code>new[]</code> å’Œ <code>delete[]</code> åªæ˜¯å¯¹ <code>new</code> å’Œ <code>delete</code> çš„å°è£…<a class="hash-link" href="#new-and-delete-are-just-wrappers-of-new-and-delete" title="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥">#</a></h4><p>æœ‰æ„æ€çš„æ˜¯ï¼Œä» <code>operator new[]</code> çš„å®ç°ï¼ˆ<a href="https://github.com/gcc-mirror/gcc/blob/releases/gcc-11.2.0/libstdc++-v3/libsupc++/new_opv.cc#L29-L33" target="_blank" rel="noopener noreferrer">æºç </a>ï¼‰æ¥çœ‹ï¼Œ<code>new[]</code> åœ¨ <code>stdlibc++</code> ä¸­åªæ˜¯ <code>new</code> çš„ä¸€ä¸ªåˆ«åã€‚</p><div class="codeBlockContainer_K1bP"><div style="color:#bfc7d5;background-color:#292d3e" class="codeBlockTitle_eoMF">/libstdc++-v3/libsupc++/new_opv.cc:L29-33</div><div class="codeBlockContent_hGly cpp"><pre tabindex="0" class="prism-code language-cpp codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">_GLIBCXX_WEAK_DEFINITION </span><span class="token keyword" style="font-style:italic">void</span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">operator</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">new</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">std</span><span class="token operator" style="color:rgb(137, 221, 255)">::</span><span class="token plain">size_t sz</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">_GLIBCXX_THROW</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">std</span><span class="token operator" style="color:rgb(137, 221, 255)">::</span><span class="token plain">bad_alloc</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">return</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">::</span><span class="token keyword" style="font-style:italic">operator</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">new</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">sz</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span></span></code></pre><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" class="copyButton_Ue-o clean-btn">å¤åˆ¶</button></div></div><p>å¯¹ <code>delete[]</code>ï¼ˆ<a href="https://github.com/gcc-mirror/gcc/blob/releases/gcc-11.2.0/libstdc++-v3/libsupc++/del_opv.cc#L32-L36" target="_blank" rel="noopener noreferrer">æºç </a>ï¼‰è€Œè¨€äº¦æ˜¯å¦‚æ­¤ï¼Œå®ƒä¸è¿‡æ˜¯ <code>delete</code> çš„åˆ«åã€‚</p><div class="admonition admonition-caution alert alert--warning"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>caution</h5></div><div class="admonition-content"><p>æ ¹æ® GNU stdlibc++ çš„å®ç°æ¥çœ‹ï¼Œä¼¼ä¹æ··åˆä½¿ç”¨ <code>new[]</code> ä¸ <code>new</code>ï¼Œä»¥åŠ <code>delete[]</code> ä¸ <code>delete</code> æ˜¯å®Œå…¨å¯ä»¥æ¥å—çš„ã€‚</p><p>ä½†æ˜¯ï¼Œä½ åº”å½“é¿å…è¿™ä¹ˆåšï¼Œå› ä¸ºè¿™ç§è¡Œä¸ºæ˜¯å–å†³äºå®ç°çš„ã€‚æ ¹æ® <a href="https://timsong-cpp.github.io/cppwp/expr.delete#2" target="_blank" rel="noopener noreferrer">C++ Working Paper</a>ï¼Œä½¿ç”¨ <code>new</code> å’Œ <code>delete</code> è€Œä¸æ˜¯ <code>new[]</code> å’Œ <code>delete[]</code> ä¼šå¯¼è‡´æœªå®šä¹‰çš„è¡Œä¸ºï¼Œè¿™ä¼šä½¿è°ƒè¯•å˜å¾—ä¸€å›¢ç³Ÿã€‚</p></div></div><h4><a aria-hidden="true" tabindex="-1" class="anchor anchor__h4 anchorWithStickyNavbar_31ik" id="and-new--delete-are-wrappers-of-malloc-and-free"></a>è€Œ <code>new</code> å’Œ <code>delete</code> ä¸è¿‡æ˜¯å¯¹ <code>malloc</code> å’Œ <code>free</code> çš„å°è£…<a class="hash-link" href="#and-new--delete-are-wrappers-of-malloc-and-free" title="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥">#</a></h4><p>è®©æˆ‘ä»¬æ¥ä¸‹æ¥çœ‹çœ‹ <code>new</code> çš„ <a href="https://github.com/gcc-mirror/gcc/blob/releases/gcc-11.2.0/libstdc++-v3/libsupc++/new_op.cc#L41-L59" target="_blank" rel="noopener noreferrer">æºç </a>ã€‚å®ƒä¹Ÿåªæ˜¯ä¸€ä¸ªå¯¹ C ä¸­çš„ <code>malloc</code> åŠ ä¸Šä¸€äº›é”™è¯¯å¤„ç†çš„å°è£…ï¼Œå¹¶ä¼šåœ¨æœ€åç»™è°ƒç”¨è€… return ä¸€ä¸ª <code>malloc</code> è¿”å›çš„åŸå§‹æŒ‡é’ˆã€‚</p><div class="codeBlockContainer_K1bP"><div style="color:#bfc7d5;background-color:#292d3e" class="codeBlockTitle_eoMF">/libstdc++-v3/libsupc++/new_op.cc:L41-59</div><div class="codeBlockContent_hGly cpp"><pre tabindex="0" class="prism-code language-cpp codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">_GLIBCXX_WEAK_DEFINITION </span><span class="token keyword" style="font-style:italic">void</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">operator</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">new</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">std</span><span class="token operator" style="color:rgb(137, 221, 255)">::</span><span class="token plain">size_t sz</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">_GLIBCXX_THROW</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">std</span><span class="token operator" style="color:rgb(137, 221, 255)">::</span><span class="token plain">bad_alloc</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">void</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain">p</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">/* malloc (0) is unpredictable; avoid it.  */</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token function" style="color:rgb(130, 170, 255)">__builtin_expect</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">sz </span><span class="token operator" style="color:rgb(137, 221, 255)">==</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">false</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    sz </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">while</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">p </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">malloc</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">sz</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">==</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      new_handler handler </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> std</span><span class="token operator" style="color:rgb(137, 221, 255)">::</span><span class="token function" style="color:rgb(130, 170, 255)">get_new_handler</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token keyword" style="font-style:italic">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token operator" style="color:rgb(137, 221, 255)">!</span><span class="token plain"> handler</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token function" style="color:rgb(130, 170, 255)">_GLIBCXX_THROW_OR_ABORT</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token function" style="color:rgb(130, 170, 255)">bad_alloc</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token function" style="color:rgb(130, 170, 255)">handler</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">return</span><span class="token plain"> p</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span></span></code></pre><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" class="copyButton_Ue-o clean-btn">å¤åˆ¶</button></div></div><p><code>delete</code>ï¼ˆ<a href="https://github.com/gcc-mirror/gcc/blob/releases/gcc-11.2.0/libstdc++-v3/libsupc++/del_op.cc#L46-L50" target="_blank" rel="noopener noreferrer">æºç </a>ï¼‰æ›´åŠ ç®€å•ï¼Œç›´æ¥è°ƒç”¨äº† C ä¸­çš„ <code>free</code>ã€‚</p><div class="codeBlockContainer_K1bP"><div style="color:#bfc7d5;background-color:#292d3e" class="codeBlockTitle_eoMF">libstdc++-v3/libsupc++/del_op.cc:L46-50</div><div class="codeBlockContent_hGly cpp"><pre tabindex="0" class="prism-code language-cpp codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">_GLIBCXX_WEAK_DEFINITION </span><span class="token keyword" style="font-style:italic">void</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">operator</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">delete</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">void</span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain"> ptr</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">noexcept</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  std</span><span class="token operator" style="color:rgb(137, 221, 255)">::</span><span class="token function" style="color:rgb(130, 170, 255)">free</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">ptr</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span></span></code></pre><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" class="copyButton_Ue-o clean-btn">å¤åˆ¶</button></div></div><p>è¿™æ ·ä¸€æ¥ï¼Œæˆ‘ä»¬ä¼¼ä¹éœ€è¦ä¸€è·¯æ·±å…¥åˆ° C æ ‡å‡†åº“ä¸­å¯¹ <code>malloc</code> ä¸ <code>free</code> çš„å®ç°æ‰èƒ½çŸ¥é“åœ¨æ•°ç»„çš„åˆ›å»ºä¸é”€æ¯èƒŒåç©¶ç«Ÿå‘ç”Ÿäº†ä»€ä¹ˆã€‚</p><p>ç„¶è€Œï¼Œæˆ‘ä»¬ä¸ä¼šæ¶µç›–ä¸ <code>malloc</code> ç›¸å…³çš„å…¨éƒ¨å†…å®¹ï¼ˆè¿™äº›å†…å®¹æœ¬èº«å°±è¶³å¤Ÿæ’‘èµ·å¦å¤–ä¸€ç¯‡æ–‡ç« äº†ï¼‰ï¼Œæˆ‘ä»¬å°†ä¸»è¦å…³æ³¨ <code>malloc</code> å¦‚ä½•ç»„ç»‡å®ƒåˆ†é…çš„å†…å­˜ç©ºé—´ï¼ˆç­”æ¡ˆï¼šåœ¨å †ä¸Šæ„å»º <code>malloc_chunk</code>ï¼‰ä»¥åŠ <code>free</code> æ˜¯å¦‚ä½•çŸ¥é“å»é‡Šæ”¾å“ªå—å†…å­˜çš„ã€‚</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="how-are-malloc_chunks-structured"></a><code>malloc_chunk</code> çš„ç»“æ„æ˜¯ä»€ä¹ˆæ ·çš„?<a class="hash-link" href="#how-are-malloc_chunks-structured" title="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥">#</a></h3><div class="admonition admonition-info alert alert--info"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</h5></div><div class="admonition-content"><p>ä¸ä¸ŠèŠ‚ä¸€æ ·ï¼Œæˆ‘å°†ä½¿ç”¨ GNU å¯¹ C æ ‡å‡†åº“çš„å®ç°, å³ <code>glibc</code>ã€‚
glibc çš„å½“å‰ç‰ˆæœ¬æ˜¯åœ¨ 2021 å¹´ 8 æœˆ 2 æ—¥ release å‡ºçš„ <a href="https://sourceware.org/git/?p=glibc.git;a=tag;h=refs/tags/glibc-2.34" target="_blank" rel="noopener noreferrer">glibc 2.34</a>ã€‚</p></div></div><p>ä»¥ä¸‹å†…å®¹æ¥è‡ª glibc ä¸­ <code>malloc/malloc.c</code> çš„æ³¨é‡Šï¼ˆ<a href="https://sourceware.org/git/?p=glibc.git;a=blob;f=malloc/malloc.c;h=e065785af77af72c17c773517c15b248b067b4ad;hb=ae37d06c7d127817ba43850f0f898b793d42aea7#l1168" target="_blank" rel="noopener noreferrer">æºç </a>ï¼‰ã€‚ä»¥ä¸‹å†…å®¹ä¸ºè‹±æ–‡åŸæ–‡ï¼Œæˆ‘å¯èƒ½ä¼šåœ¨ä¹‹åæŸä¸ªæ—¶å€™è€ƒè™‘å°†å…¶ç¿»è¯‘ä¸ºä¸­æ–‡ã€‚æˆ‘åœ¨åŸæ–‡ä¹‹ä¸Šè¿›è¡Œäº†ä¸€äº›å¾®å°çš„ç¼–è¾‘ä»¥å°†å…¶é€‚é…ä¸º Markdown æ ¼å¼ï¼ˆæœ¬ç½‘ç«™ä½¿ç”¨çš„æ ¼å¼åŒ–å·¥å…·ï¼‰ã€‚</p><blockquote><p>(The following includes lightly edited explanations by Colin Plumb.)</p><p>Chunks of memory are maintained using a `boundary tag&#x27; method as
described in e.g., Knuth or Standish. (See the paper by Paul
Wilson <a href="ftp://ftp.cs.utexas.edu/pub/garbage/allocsrv.ps" target="_blank" rel="noopener noreferrer">ftp://ftp.cs.utexas.edu/pub/garbage/allocsrv.ps</a> for a
survey of such techniques.) Sizes of free chunks are stored both
in the front of each chunk and at the end. This makes
consolidating fragmented chunks into bigger chunks very fast. The
size fields also hold bits representing whether chunks are free or
in use.</p><p>An allocated chunk looks like this:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">    chunk-&gt; +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            |             Size of previous chunk, if unallocated (P clear)  |</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            |             Size of chunk, in bytes                     |A|M|P|</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      mem-&gt; +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            |             User data starts here...                          .</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            .                                                               .</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            .             (malloc_usable_size() bytes)                      .</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            .                                                               |</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">nextchunk-&gt; +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            |             (size of chunk, but used for application data)    |</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            |             Size of next chunk, in bytes                |A|0|1|</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span></span></code></pre><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" class="copyButton_Ue-o clean-btn">å¤åˆ¶</button></div></div><p>Where &quot;chunk&quot; is the front of the chunk for the purpose of most of
the malloc code, but &quot;mem&quot; is the pointer that is returned to the
user. &quot;Nextchunk&quot; is the beginning of the next contiguous chunk.</p><p>Chunks always begin on even word boundaries, so the mem portion
(which is returned to the user) is also on an even word boundary, and
thus at least double-word aligned.</p><p>Free chunks are stored in circular doubly-linked lists, and look like this:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">    chunk-&gt; +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            |             Size of previous chunk, if unallocated (P clear)  |</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    `head:&#x27; |             Size of chunk, in bytes                     |A|0|P|</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      mem-&gt; +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            |             Forward pointer to next chunk in list             |</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            |             Back pointer to previous chunk in list            |</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            |             Unused space (may be 0 bytes long)                .</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            .                                                               .</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            .                                                               |</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">nextchunk-&gt; +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    `foot:&#x27; |             Size of chunk, in bytes                           |</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            |             Size of next chunk, in bytes                |A|0|0|</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span></span></code></pre><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" class="copyButton_Ue-o clean-btn">å¤åˆ¶</button></div></div><p>The P (<code>PREV_INUSE</code>) bit, stored in the unused low-order bit of the
chunk size (which is always a multiple of two words), is an in-use
bit for the <em>previous</em> chunk. If that bit is <em>clear</em>, then the
word before the current chunk size contains the previous chunk
size, and can be used to find the front of the previous chunk.
The very first chunk allocated always has this bit set,
preventing access to non-existent (or non-owned) memory. If
<code>prev_inuse</code> is set for any given chunk, then you CANNOT determine
the size of the previous chunk, and might even get a memory
addressing fault when trying to do so.</p><p>[...]</p><p>Note that the <code>foot</code> of the current chunk is actually represented
as the <code>prev_size</code> of the NEXT chunk. This makes it easier to
deal with alignments etc but can be very confusing when trying
to extend or adapt this code.</p><p>[...]</p></blockquote><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="a-verification-using-poc"></a>åˆ©ç”¨ PoC ä»£ç çš„éªŒè¯<a class="hash-link" href="#a-verification-using-poc" title="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥">#</a></h3><p>ç°åœ¨æˆ‘ä»¬å°†ä½¿ç”¨ <code>gdb</code> æ‰“å°å‡ºå†…å­˜åŒºåŸŸå¹¶éªŒè¯ä»¥ä¸Šçš„è§£é‡Šåœ¨æˆ‘ä»¬çš„ä»£ç ä¸­æ˜¯å¦‚ä½•å·¥ä½œçš„ã€‚è¿™é‡Œæˆ‘å°†ä½¿ç”¨ <a href="https://gef.readthedocs.io/en/master/commands/heap/#heap-chunk-command" target="_blank" rel="noopener noreferrer">GEF</a> çš„ <code>heap</code> åŠŸèƒ½æ¥æ›´å¥½åœ°æ˜¾ç¤º <code>malloc</code> åˆ†é…çš„ chunk çš„å±æ€§ã€‚</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">gefâ¤  heap chunk arr</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Chunk(addr=0x55555556aeb0, size=0x30, flags=PREV_INUSE)</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Chunk size: 48 (0x30)</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Usable size: 40 (0x28)</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Previous chunk size: 0 (0x0)</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">PREV_INUSE flag: On</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">IS_MMAPPED flag: Off</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">NON_MAIN_ARENA flag: Off</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">gefâ¤  x/16xw 0x55555556aeb0-16</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">0x55555556aea0: 0x00000000  0x00000000  0x00000031  0x00000000</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">0x55555556aeb0: 0x44434241  0x48474645  0x4c4b4a49  0x504f4e4d</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">0x55555556aec0: 0x54535251  0x58575655  0x00005a59  0x00000000</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">0x55555556aed0: 0x00000000  0x00000000  0x0000f131  0x00000000</span></span></code></pre><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" class="copyButton_Ue-o clean-btn">å¤åˆ¶</button></div></div><p>å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œchunk çš„å¤§å°æ˜¯ 48 å­—èŠ‚ï¼Œå¯ç”¨å¤§å°ï¼ˆå®é™…å­˜å‚¨ç”¨æˆ·å†…å®¹çš„åŒºåŸŸï¼‰ä¸º 40 å­—èŠ‚ï¼Œè¦è¿œè¿œå¤§å‡ºæˆ‘ä»¬æ‰€è¯·æ±‚çš„ï¼ˆ26 ä¸ªå­—ç¬¦çš„æ•°ç»„ï¼Œåº”å½“å æ® 26 å­—èŠ‚çš„ç©ºé—´ï¼‰ã€‚è¿™æ˜¯å› ä¸º â€œchunk æ°¸è¿œå¼€å§‹äºåŒæ•° å­—ï¼ˆwordï¼‰çš„è¾¹ç•Œâ€¦â€¦å› æ­¤è‡³å°‘æ˜¯åŒå­—å¯¹é½çš„â€<sup id="fnref-1"><a href="#fn-1" class="footnote-ref">1</a></sup></p><div class="admonition admonition-info alert alert--info"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</h5></div><div class="admonition-content"><p>ä¸€ä¸ª <a href="https://zh.wikipedia.org/zh-cn/%E5%AD%97_(%E8%AE%A1%E7%AE%97%E6%9C%BA)" target="_blank" rel="noopener noreferrer">å­—ï¼ˆwordï¼‰</a> çš„å¤§å°æ˜¯å–å†³äºç³»ç»Ÿæ¶æ„çš„ã€‚ä¸€èˆ¬è€Œè¨€ï¼Œ64 ä½ç³»ç»Ÿçš„å­—é•¿ä¸º 64 æ¯”ç‰¹ï¼Œä¹Ÿå°±æ˜¯ 8 å­—èŠ‚ã€‚ç„¶è€Œï¼Œåœ¨ <code>gdb</code> çš„ <code>x/w</code> å‘½ä»¤ä¸­ï¼Œå­—é•¿ä¸ºå›ºå®šçš„ 32 æ¯”ç‰¹ï¼ˆ4 å­—èŠ‚ï¼‰ï¼Œéå¸¸ä»¤äººè¿·æƒ‘ã€‚å› æ­¤ï¼Œæˆ‘å°†ä½¿ç”¨â€œå­—â€ä»£æŒ‡ç°å®ä¸­çš„å–å†³äºç³»ç»Ÿçš„å¯å˜é•¿åº¦çš„å­—ï¼Œè€Œä½¿ç”¨â€œ32 æ¯”ç‰¹å­—â€ä»£æŒ‡ <code>gdb</code> ä¸­çš„å­—ã€‚</p></div></div><p>å› ä¸ºå†…å­˜ä¸­çš„ chunk æ°¸è¿œæ˜¯åŒå­—å¯¹é½çš„ï¼Œæˆ‘ä»¬åº”è¯¥ä»åœ°å€ä¸­å‡å» <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>2</mn><mo>Ã—</mo><mn>8</mn><mo>=</mo><mn>16</mn></mrow><annotation encoding="application/x-tex">2\times8=16</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.72777em;vertical-align:-0.08333em"></span><span class="mord">2</span><span class="mspace" style="margin-right:0.2222222222222222em"></span><span class="mbin">Ã—</span><span class="mspace" style="margin-right:0.2222222222222222em"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em"></span><span class="mord">8</span><span class="mspace" style="margin-right:0.2777777777777778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em"></span><span class="mord">1</span><span class="mord">6</span></span></span></span></span> å­—èŠ‚æ¥è·å¾—æŒ‡å‘ <code>chunk</code> çš„æŒ‡é’ˆåœ°å€ã€‚è¿™é‡Œçš„ç¬¬ä¸€ä¸ªå­—ï¼ˆåœ¨ gdb ä¸­æ˜¾ç¤ºä¸ºä¸¤ä¸ª 32 æ¯”ç‰¹å­—ï¼‰è¢« <code>0x00</code> å¡«æ»¡äº†ï¼›å¹¶ä¸”å°†åœ¨ <code>P</code> flag è¢«å¤ä½æ—¶å¡«å…¥ä¸Šä¸€ä¸ª chunk çš„å¤§å°ã€‚</p><p>ç¬¬äºŒä¸ªå­— <code>0x31</code>ï¼ˆæˆ–æ˜¯ <code>0b110001</code>ï¼‰å­˜å‚¨äº†è¯¥ chunk çš„å¤§å°ä»¥åŠ 3 ä¸ª flagã€‚æœ€ä½æœ‰æ•ˆä½ï¼ˆLSBï¼‰<code>0b1</code> ä»£è¡¨ flag <code>P</code> (PREV_INUSE) è¢«è®¾ç½®äº†ï¼Œå› æ­¤ä¸Šä¸€ä¸ª chunk è¿˜æœªè¢«é‡Šæ”¾ã€‚å› ä¸ºæ‰€æœ‰ chunk çš„å¤§å°éƒ½å¿…é¡»è‡³å°‘æ˜¯ 8 å­—èŠ‚çš„æ•´æ•°å€ï¼Œå› æ­¤å…¶å¤§å°çš„ 3 ä¸ªæœ€ä½æœ‰æ•ˆä½éƒ½å¿…å®šä¸º 0ï¼Œè¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆè¿™ä¸‰ä½ LSB èƒ½è¢«ç”¨ä½œ flagã€‚åœ¨è®¡ç®— chunk å¤§å°æ—¶ï¼Œæˆ‘ä»¬èƒ½å¤Ÿç›´æ¥ä¸¢å¼ƒä¸‰ä½ LSB å¹¶å–å¾— <code>0b110000</code>ï¼ˆ<code>0x30</code>ï¼Œæˆ–æ˜¯ 48ï¼‰å­—èŠ‚ã€‚</p><div class="admonition admonition-note alert alert--secondary"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</h5></div><div class="admonition-content"><p>å¦‚æœä½ è¶³å¤Ÿä»”ç»†çš„è¯ï¼Œä½ å¯èƒ½å·²ç»å‘ç°äº†ï¼šchunk çš„å¯ç”¨å¤§å°æ˜¯ 40 å­—èŠ‚ï¼Œåªæ¯” chunk å¤§å°å°äº† 8 å­—èŠ‚ï¼ˆè€Œä¸æ˜¯ 16ï¼‰ï¼Œä¹Ÿå°±æ˜¯ä¸€ä¸ªå­—ã€‚</p><p>è¿™æ˜¯å› ä¸º <code>chunk</code> æŒ‡é’ˆ â€œæŒ‡å‘çš„å¹¶ä¸æ˜¯æœ¬ chunk çš„å¼€å§‹ï¼Œè€Œæ˜¯ä¸Šä¸€ chunk çš„æœ€åä¸€å­—â€<sup id="fnref-2"><a href="#fn-2" class="footnote-ref">2</a></sup>ï¼ˆ<a href="https://sourceware.org/glibc/wiki/MallocInternals#What_is_a_Chunk.3F" target="_blank" rel="noopener noreferrer">æ¥æº</a>ï¼‰ã€‚å®é™…ä¸Šï¼Œchunk å¼€å§‹äº <code>chunk</code> æŒ‡é’ˆæŒ‡å‘çš„åä¸€ä¸ªå­—ï¼ˆä¹Ÿå°±æ˜¯å­˜å‚¨ chunk å¤§å°çš„å­—ï¼‰ã€‚</p></div></div><p>ä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬ â€œå®é™…çš„â€ chunk å¼€å§‹äºå†…å­˜åœ°å€ <code>0x55555556aea8</code> å¹¶ç»“æŸäº <code>0x55555556aec8</code>ã€‚æ•°æ®åŒºåŸŸå¼€å§‹äº <code>0x55555556aeb0</code> å¹¶ç»“æŸäº <code>0x55555556aec8</code>ã€‚åŒç†ï¼Œä¸‹ä¸€ä¸ª <code>chunk</code> æŒ‡é’ˆæŒ‡å‘çš„æ˜¯æœ¬ chunk çš„æ•°æ®åŒºåŸŸçš„æœ€åä¸€ä¸ªå­—ï¼ˆ<code>0x55555556aec8</code>ï¼‰ã€‚</p><p>æ—¢ç„¶å¦‚æ­¤ï¼Œä¸ºä»€ä¹ˆ chunk æŒ‡é’ˆä¼šä»¤äººè¿·æƒ‘åœ°æŒ‡å‘å‰ä¸€ chunk çš„æœ€åä¸€å­—å‘¢ï¼Ÿç­”æ¡ˆä¸ <code>free</code> è®¾è®¡çš„ç†å¿µæœ‰å…³ã€‚</p><p>å½“å‰ä¸€ä¸ª chunk è¢« free æ—¶ï¼Œå®ƒä¼šæŠŠæœ€åä¸€å­—å¡«å……ä¸ºå®ƒçš„å¤§å°ï¼Œå¹¶æ¸…é™¤ä¸‹ä¸€ä¸ª chunkï¼ˆæœ¬ chunkï¼‰ä¸­çš„ P flagã€‚è¿™æ ·ï¼Œæœ¬ chunk å°±å¯ä»¥é€šè¿‡è¿™ä¸ªå¤§å°åœ¨å‰ä¸€ chunk è¢«é‡Šæ”¾å â€œæ‰¾åˆ°å‰ä¸€ chunk çš„èµ·å§‹ä½ç½®â€ <sup id="fnref-3"><a href="#fn-3" class="footnote-ref">3</a></sup>ã€‚</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="how-does-free-work"></a><code>free</code> æ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Ÿ<a class="hash-link" href="#how-does-free-work" title="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥">#</a></h3><p>åˆ°ç°åœ¨ï¼Œä½ åº”è¯¥å·²ç»çŸ¥é“ â€œ<code>delete[]</code> å¦‚ä½•çŸ¥é“å®ƒéœ€è¦é‡Šæ”¾å“ªå—å†…å­˜ï¼Ÿâ€ çš„ç­”æ¡ˆäº†ï¼šå› ä¸ºè¿™ä¸ª chunk çš„å¤§å°å°±è¢«å­˜å‚¨åœ¨å®ƒçš„å…ƒæ•°æ®ä¸­ã€‚</p><p>ä½†æ˜¯ï¼Œè¿˜æ˜¯æœ‰ä¸€äº›ç»†èŠ‚å€¼å¾—æˆ‘ä»¬è¿›è¡Œæ¢è®¨ï¼šä¸ºä»€ä¹ˆ chunk æŒ‡é’ˆè¦æŒ‡å‘ä¸Šä¸€ chunk çš„ç»“å°¾ï¼Ÿæˆ‘ä»¬ä¸ºä»€ä¹ˆéœ€è¦ <code>PREV_INUSE</code> (P) flagï¼Ÿä¸ºäº†è§£ç­”è¿™äº›ç–‘é—®ï¼Œæˆ‘ä»¬éœ€è¦äº†è§£ <code>free</code> æ˜¯å¦‚ä½•å·¥ä½œçš„ã€‚</p><div class="admonition admonition-note alert alert--secondary"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</h5></div><div class="admonition-content"><p>åœ¨é˜…è¯»æœ¬èŠ‚æ—¶ï¼Œä½ å¯ä»¥ä¸ <a href="#how-are-malloc_chunks-structured"><code>malloc_chunk</code> çš„ç»“æ„æ˜¯ä»€ä¹ˆæ ·çš„?</a> èŠ‚è¿›è¡Œäº¤å‰å¯¹ç…§ï¼Œä»¥æŸ¥çœ‹ chunk åœ¨ <code>free</code> å‰åçš„ç»“æ„åˆ†åˆ«æ˜¯ä»€ä¹ˆæ ·å­çš„ã€‚</p></div></div><p>é•¿è¯çŸ­è¯´ï¼Œ<code>free</code> å¤§è‡´æ˜¯å¦‚ä¸‹å·¥ä½œçš„ã€‚å½“å®ƒè¢«è°ƒç”¨æ—¶ï¼ˆ<a href="https://sourceware.org/git/?p=glibc.git;a=blob;f=malloc/malloc.c;h=e065785af77af72c17c773517c15b248b067b4ad;hb=ae37d06c7d127817ba43850f0f898b793d42aea7#l3237" target="_blank" rel="noopener noreferrer">æºç </a>ï¼‰ï¼Œç”¨æˆ·ä¼šä¼ ç»™å®ƒä¸€ä¸ªæŒ‡å‘æ•°æ®åœ°å€çš„æŒ‡é’ˆã€‚<code>free</code> åˆ™ä¼šè°ƒç”¨ <code>mem2chunk</code>ï¼ˆ<a href="https://sourceware.org/git/?p=glibc.git;a=blob;f=malloc/malloc.c;h=e065785af77af72c17c773517c15b248b067b4ad;hb=ae37d06c7d127817ba43850f0f898b793d42aea7#l1310" target="_blank" rel="noopener noreferrer">æºç </a>ï¼‰å°†å…¶è½¬æ¢ä¸ºæŒ‡å‘ chunk å¤´çš„æŒ‡é’ˆã€‚
éšåï¼Œå¦‚æœè¿™ä¸€ chunk æ˜¯è¢« <code>mmap</code> åˆ†é…çš„ï¼ˆå¯ç”± M flag å¾—çŸ¥ï¼‰ï¼Œ<code>free</code> ä¼šè°ƒç”¨ <code>munmap</code>ï¼ˆ<a href="https://man.archlinux.org/man/munmap.3p.en" target="_blank" rel="noopener noreferrer">man 3p</a> | <a href="https://man.archlinux.org/man/munmap.2.en" target="_blank" rel="noopener noreferrer">man 2</a>ï¼‰è¿›è¡Œé‡Šæ”¾ï¼›å¦‚æœä¸æ˜¯ï¼Œå®ƒä¼šå°† chunk æŒ‡é’ˆä¼ ç»™ <code>_int_free</code>ï¼ˆ<a href="https://sourceware.org/git/?p=glibc.git;a=blob;f=malloc/malloc.c;h=e065785af77af72c17c773517c15b248b067b4ad;hb=ae37d06c7d127817ba43850f0f898b793d42aea7#l4302" target="_blank" rel="noopener noreferrer">æºç </a>ï¼‰æ­£å¼è¿›è¡Œé‡Šæ”¾ã€‚</p><p>ç„¶è€Œï¼Œ <code>free</code> ä¸€ä¸ª chunk â€œå¹¶ä¸ä¼šå°†å…¶äº¤è¿˜æ“ä½œç³»ç»Ÿä»¥ç»™å…¶ä»–ç¨‹åºä½¿ç”¨ã€‚<code>free()</code> è°ƒç”¨ä»…ä»…æ˜¯å°†è¿™å—å†…å­˜æ ‡è®°ä¸º â€˜å¯è¢«æœ¬ç¨‹åºé‡æ–°ä½¿ç”¨â€™ï¼Œä½†å¯¹äºæ“ä½œç³»ç»Ÿè€Œè¨€ï¼Œè¿™å—å†…å­˜ä»ç„¶ â€˜å±äºâ€™ åº”ç”¨ç¨‹åºâ€<sup id="fnref-4"><a href="#fn-4" class="footnote-ref">4</a></sup>ï¼ˆ<a href="https://sourceware.org/glibc/wiki/MallocInternals#Free_Algorithm" target="_blank" rel="noopener noreferrer">æ¥æº</a>ï¼‰çš„å †ä¸Šã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå †ç®¡ç†å™¨ä»ç„¶éœ€è¦è¿½è¸ªè¿™å—å†…å­˜ï¼Œå¹¶åœ¨åˆé€‚çš„æ—¶å€™é‡æ–°ä½¿ç”¨å®ƒã€‚</p><p>è¿™å°±æ˜¯ä¸ºä»€ä¹ˆæˆ‘ä»¬ä½¿ç”¨äº†ä¸€ä¸ªå¾ªç¯é“¾è¡¨æ¥ç»„ç»‡è¢« <code>free</code> çš„ chunk ä»¬ï¼Œå…¶ä¸­æ¯ä¸€ä¸ª chunk éƒ½å­˜å‚¨äº†æŒ‡å‘å‰ä¸€ä¸ªä¸åä¸€ä¸ª chunk çš„æŒ‡é’ˆã€‚æ­¤å¤–ï¼Œæ¯ä¸ª chunk çš„å¤§å°ä¼šè¢«å­˜å‚¨åœ¨å®ƒå†…å­˜çš„æœ€åä¸€ä¸ªå­—ï¼Œå³ä¸‹ä¸€ä¸ª chunk çš„ <code>chunk</code> æŒ‡é’ˆã€‚è¿™æ ·ä¸€æ¥ï¼Œä¸‹ä¸€ä¸ª chunk å¯ä»¥åˆ©ç”¨è¿™ä¸€å¤§å°è®¿é—®è¿™ä¸ªè¢« <code>free</code> çš„ chunk ä»¥åŠå®ƒçš„ headerã€‚å½“ä¸‹ä¸€ä¸ª chunk ä¹Ÿè¢« <code>free</code> æ—¶ï¼Œæˆ‘ä»¬èƒ½å¤Ÿåˆ©ç”¨è¿™ä¸€å±æ€§æ¥ åˆå¹¶ï¼ˆ<a href="https://cs.stackexchange.com/a/18234" target="_blank" rel="noopener noreferrer">coalesce</a>ï¼‰è¿™ä¸¤ä¸ª chunkã€‚</p><p>å½“ç„¶äº†ï¼Œå®é™…çš„ <code>free</code> æ“ä½œè¦è¿œæ¯”è¿™å¤æ‚ï¼Œä¸” chunk ä»¬ä¹Ÿä¼šä¸ºäº†æ›´é«˜æ•ˆçš„å†åˆ†é…ï¼ˆreallocationï¼‰è¢«æ”¾ç½®åˆ°ä¸åŒçš„ bin ä¸­ã€‚ ä½ å¯ä»¥é˜…è¯»å®˜æ–¹çš„ <a href="https://sourceware.org/glibc/wiki/MallocInternals" target="_blank" rel="noopener noreferrer">glibc wiki</a>ï¼Œè¿™ç¯‡æ›´ä¸ºè¯¦ç»†çš„ <a href="https://azeria-labs.com/heap-exploitation-part-2-glibc-heap-free-bins/" target="_blank" rel="noopener noreferrer">åšæ–‡</a>ï¼Œæˆ–æ˜¯ <a href="https://sourceware.org/git/?p=glibc.git;a=blob;f=malloc/malloc.c;h=e065785af77af72c17c773517c15b248b067b4ad;hb=ae37d06c7d127817ba43850f0f898b793d42aea7#l4302" target="_blank" rel="noopener noreferrer"><code>_int_free</code> çš„æºç </a> ä»¥äº†è§£æ›´å¤šåº•å±‚ç»†èŠ‚ã€‚</p><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="how-can-we-prevent-memory-leaks"></a>æˆ‘ä»¬å¦‚ä½•é¢„é˜²å†…å­˜æ³„æ¼ï¼Ÿ<a class="hash-link" href="#how-can-we-prevent-memory-leaks" title="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥">#</a></h2><p>ç°åœ¨å¯èƒ½æ˜¯æ—¶å€™å›åˆ°æˆ‘ä»¬å¼€å§‹çš„ä¸»é¢˜äº†ï¼šæ—¢ç„¶æˆ‘ä»¬å·²ç»çŸ¥é“äº†å†…å­˜æ³„æ¼æ˜¯ä»€ä¹ˆï¼Œä»¥åŠå®ƒä»¬æ˜¯å¦‚ä½•å‘ç”Ÿçš„ï¼Œé‚£ä¹ˆæˆ‘ä»¬æœ‰ä»€ä¹ˆåŠæ³•é¢„é˜²å†…å­˜æ³„æ¼å—ï¼Ÿ</p><ol><li>æ°¸è¿œ <code>delete</code> (<code>delete[]</code>) ä½¿ç”¨ <code>new</code> (<code>new[]</code>) åˆ›å»ºçš„å¯¹è±¡<ul><li>è¿™æ˜¯æˆ‘ä»¬èƒ½åšçš„æœ€ç®€å•çš„äº‹æƒ…ï¼Œå¦‚æœä½ ä»ç„¶åšæŒä½¿ç”¨ <code>new</code> çš„è¯</li></ul></li><li>é¿å…ç›´æ¥è°ƒç”¨ <code>new</code> ä¸ <code>delete</code><ul><li><a href="https://isocpp.github.io/CppCoreGuidelines/CppCoreGuidelines#r11-avoid-calling-new-and-delete-explicitly" target="_blank" rel="noopener noreferrer">è¯´æ˜</a>ï¼ˆè‹±è¯­ï¼‰</li><li><strong>å¤ªé•¿ä¸çœ‹</strong>ï¼šä½¿ç”¨èµ„æºå¥æŸ„ï¼ˆresource handleï¼‰è€Œä¸æ˜¯è£¸æŒ‡é’ˆï¼Œåè€…å…·æœ‰æ³„æ¼çš„å¯èƒ½æ€§ã€‚</li><li>è§£å†³æ–¹æ³•ï¼šä½¿ç”¨è¯¸å¦‚ <code>unique_ptr</code> ä¸ <code>shared_ptr</code> çš„æ™ºèƒ½æŒ‡é’ˆã€‚</li></ul></li><li>ä¸è¦ç”¨è£¸æŒ‡é’ˆï¼ˆ<code>T*</code>ï¼‰æˆ–å¼•ç”¨ï¼ˆ<code>T&amp;</code>ï¼‰æ¥è½¬ç§»æ‰€æœ‰æƒï¼ˆownershipï¼‰<ul><li><a href="https://isocpp.github.io/CppCoreGuidelines/CppCoreGuidelines#i11-never-transfer-ownership-by-a-raw-pointer-t-or-reference-t" target="_blank" rel="noopener noreferrer">è¯´æ˜</a>ï¼ˆè‹±è¯­ï¼‰</li><li><strong>å¤ªé•¿ä¸çœ‹</strong>ï¼šå®¹æ˜“äº§ç”Ÿâ€œè°åº”å½“åˆ é™¤æŒ‡é’ˆâ€çš„æ­§ä¹‰ã€‚</li><li>è§£å†³æ–¹æ³•ï¼šç›´æ¥ return å¯¹è±¡æœ¬èº«ï¼Œæˆ–æ˜¯ä½¿ç”¨æ™ºèƒ½æŒ‡é’ˆã€‚</li></ul></li></ol><p>ä¸€èˆ¬æ¥è¯´ï¼Œè¦æ±‚ç¨‹åºå‘˜æ‰‹åŠ¨é‡Šæ”¾èµ„æºæ˜¯å¾ˆå®¹æ˜“å‡ºé”™çš„ã€‚ä½ åº”è¯¥è€ƒè™‘ <a href="https://isocpp.github.io/CppCoreGuidelines/CppCoreGuidelines#Rr-raii" target="_blank" rel="noopener noreferrer">ä½¿ç”¨èµ„æºå¥æŸ„å’Œ RAIIï¼ˆèµ„æºè·å–å³åˆå§‹åŒ–ï¼‰è‡ªåŠ¨ç®¡ç†èµ„æº</a>ï¼ˆè‹±è¯­ï¼‰ã€‚</p><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="references--further-readings"></a>å¼•ç”¨ &amp; æ‰©å±•é˜…è¯»<a class="hash-link" href="#references--further-readings" title="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥">#</a></h2><ul><li>Stroustrup, Bjarne and Sutter, Herb. <a href="https://isocpp.github.io/CppCoreGuidelines/CppCoreGuidelines" target="_blank" rel="noopener noreferrer">&quot;C++ Core Guidelines&quot;</a>. Updated Jun 17, 2021. Accessed Aug 08, 2021.</li><li>glibc wiki. <a href="https://sourceware.org/glibc/wiki/MallocInternals" target="_blank" rel="noopener noreferrer">&quot;MallocInternals&quot;</a>. Updated May 20, 2019. Accessed Aug 08, 2021.</li><li>Azeria Labs. <a href="https://azeria-labs.com/heap-exploitation-part-2-glibc-heap-free-bins/" target="_blank" rel="noopener noreferrer">&quot;Heap Exploitation Part 2: Understanding the Glibc Heap Implementation&quot;</a>. Accessed Aug 08, 2021.</li><li>CTF Wiki. <a href="https://ctf-wiki.org/pwn/linux/user-mode/heap/ptmalloc2/heap-structure/" target="_blank" rel="noopener noreferrer">&quot;å †ç›¸å…³æ•°æ®ç»“æ„&quot;</a> (in Chinese). Accessed Aug 10, 2021.</li><li>glibc Contributors. <a href="https://sourceware.org/git/?p=glibc.git;a=tree;h=6eb9f63e6c9197e967a8cc12a8b235335e5a873d;hb=ae37d06c7d127817ba43850f0f898b793d42aea7" target="_blank" rel="noopener noreferrer">glibc v2.34 source code</a>. Aug 2, 2021. Accessed Aug 8, 2021.</li><li>gcc Contributors. <a href="https://github.com/gcc-mirror/gcc/tree/releases/gcc-11.2.0" target="_blank" rel="noopener noreferrer">gcc v11.2.0 source code</a>. Jul 28, 2021. Accessed Aug 8, 2021.</li><li>StackOverflow. <a href="https://stackoverflow.com/questions/197675/how-does-delete-know-the-size-of-the-operand-array" target="_blank" rel="noopener noreferrer">&quot;How does delete[] know the size of the operand array?&quot;</a></li></ul><p>é¡ºå¸¦ä¸€æï¼Œåœ¨æœç´¢å†…å­˜æ³„æ¼çš„æ—¶å€™ï¼Œæˆ‘åœ¨ Brookhaven National Lab çš„åŸŸåä¸‹é¢å‘ç°äº†ä¸€ä¸ª å¤§äºšæ¹¾ååº”å †ä¸­å¾®å­å®éªŒçš„ wiki é¡µé¢ <a href="https://wiki.bnl.gov/dayabay/index.php?title=Dealing_With_Memory_Leaks" target="_blank" rel="noopener noreferrer">&quot;Dealing With Memory Leaks&quot;</a>ã€‚æˆ‘éƒ½ä¸çŸ¥é“å¤§äºšæ¹¾ååº”å †è¿˜æœ‰ä¸€ä¸ªå›½é™…ç ”ç©¶é¡¹ç›® ğŸ˜‚</p><div class="footnotes"><hr><ol><li id="fn-1">&quot;chunks always begin on even word boundaries ... and thus at least double-word aligned.&quot;<a href="#fnref-1" class="footnote-backref">â†©</a></li><li id="fn-2">&quot;does not point to the beginning of the chunk, but to the last word in the previous chunk&quot;ï¼ˆ<a href="https://sourceware.org/glibc/wiki/MallocInternals#What_is_a_Chunk.3F" target="_blank" rel="noopener noreferrer">æ¥æº</a>ï¼‰<a href="#fnref-2" class="footnote-backref">â†©</a></li><li id="fn-3">&quot;to find the front of the previous chunk&quot;<a href="#fnref-3" class="footnote-backref">â†©</a></li><li id="fn-4">&quot;does not actually return it to the operating system for other applications to use. The <code>free()</code> call marks a chunk of memory as &#x27;free to be reused&#x27; by the application, but from the operating system&#x27;s point of view, the memory still &#x27;belongs&#x27; to the application&quot;ï¼ˆ<a href="https://sourceware.org/glibc/wiki/MallocInternals#Free_Algorithm" target="_blank" rel="noopener noreferrer">æ¥æº</a>ï¼‰<a href="#fnref-4" class="footnote-backref">â†©</a></li></ol></div></div><footer class="row docusaurus-mt-lg blogPostDetailsFull_3kfx"><div class="col"><b>æ ‡ç­¾ï¼š</b><ul class="tags_2ga9 padding--none margin-left--sm"><li class="tag_11ep"><a class="tag_1Okp tagRegular_3MiF" href="/zh-Hans/blog/tags/c">c++</a></li><li class="tag_11ep"><a class="tag_1Okp tagRegular_3MiF" href="/zh-Hans/blog/tags/pwn">pwn</a></li></ul></div><div class="col margin-top--sm"><a href="https://github.com/yechs/website/edit/master/blog/blog/2021-08-13-malloc_chunks.mdx" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_2_ui" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>ç¼–è¾‘æ­¤é¡µ</a></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="åšæ–‡åˆ†é¡µå¯¼èˆª"><div class="pagination-nav__item"></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/zh-Hans/blog/welcome"><div class="pagination-nav__sublabel">è¾ƒæ—§ä¸€ç¯‡</div><div class="pagination-nav__label">Me and My Broken Site(s) Â»</div></a></div></nav></main><div class="col col--2"><div class="tableOfContents_35-E thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#how-it-all-started" class="table-of-contents__link">æˆ‘ä¸ºä»€ä¹ˆå†™è¿™ç¯‡æ–‡ç« </a></li><li><a href="#what-are-memory-leaks" class="table-of-contents__link">ä»€ä¹ˆæ˜¯å†…å­˜æ³„æ¼</a><ul><li><a href="#poc" class="table-of-contents__link">PoC</a></li><li><a href="#a-deeper-look-into-the-memory" class="table-of-contents__link">åˆæ¢å†…å­˜</a></li><li><a href="#verification-with-valgrind" class="table-of-contents__link">åˆ©ç”¨ Valgrind è¿›è¡ŒéªŒè¯</a></li></ul></li><li><a href="#how-are-objects-allocated-on-the-heap" class="table-of-contents__link">å¯¹è±¡æ˜¯å¦‚ä½•åœ¨å † (heap) ä¸Šè¢«åˆ†é…çš„</a><ul><li><a href="#how-new-and-delete-works" class="table-of-contents__link"><code>new</code> ä¸ <code>delete</code> æ˜¯å¦‚ä½•å·¥ä½œçš„</a></li><li><a href="#how-are-malloc_chunks-structured" class="table-of-contents__link"><code>malloc_chunk</code> çš„ç»“æ„æ˜¯ä»€ä¹ˆæ ·çš„?</a></li><li><a href="#a-verification-using-poc" class="table-of-contents__link">åˆ©ç”¨ PoC ä»£ç çš„éªŒè¯</a></li><li><a href="#how-does-free-work" class="table-of-contents__link"><code>free</code> æ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Ÿ</a></li></ul></li><li><a href="#how-can-we-prevent-memory-leaks" class="table-of-contents__link">æˆ‘ä»¬å¦‚ä½•é¢„é˜²å†…å­˜æ³„æ¼ï¼Ÿ</a></li><li><a href="#references--further-readings" class="table-of-contents__link">å¼•ç”¨ &amp; æ‰©å±•é˜…è¯»</a></li></ul></div></div></div></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">æœ¬ç«™</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/zh-Hans/kb/intro">Knowledge Base</a></li><li class="footer__item"><a class="footer__link-item" href="/zh-Hans/blog">Blog</a></li></ul></div><div class="col footer__col"><div class="footer__title">ä¸æˆ‘è”ç³»</div><ul class="footer__items"><li class="footer__item"><a href="https://github.com/yechs" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://www.linkedin.com/in/yechs/" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>LinkedIn<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div><div class="col footer__col"><div class="footer__title">æ›´å¤š</div><ul class="footer__items"><li class="footer__item"><a href="https://wso.williams.edu/" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Williams Students Online<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://computerization.io/" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Computerization<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://0x194.com" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Team 0x194<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">æƒåˆ©æ‰€æœ‰ Â© 2021 Ye Shuã€‚ä¿ç•™éƒ¨åˆ†æƒåˆ©ã€‚</div></div></div></footer></div>
<script src="/zh-Hans/assets/js/runtime~main.02f4c884.js"></script>
<script src="/zh-Hans/assets/js/main.2b80505b.js"></script>
</body>
</html>