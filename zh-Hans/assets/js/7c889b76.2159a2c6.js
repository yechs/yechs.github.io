"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[307],{3905:(e,t,r)=>{r.d(t,{Zo:()=>c,kt:()=>d});var a=r(7294);function n(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function o(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,a)}return r}function i(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?o(Object(r),!0).forEach((function(t){n(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):o(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function s(e,t){if(null==e)return{};var r,a,n=function(e,t){if(null==e)return{};var r,a,n={},o=Object.keys(e);for(a=0;a<o.length;a++)r=o[a],t.indexOf(r)>=0||(n[r]=e[r]);return n}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)r=o[a],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(n[r]=e[r])}return n}var l=a.createContext({}),p=function(e){var t=a.useContext(l),r=t;return e&&(r="function"==typeof e?e(t):i(i({},t),e)),r},c=function(e){var t=p(e.components);return a.createElement(l.Provider,{value:t},e.children)},m={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},u=a.forwardRef((function(e,t){var r=e.components,n=e.mdxType,o=e.originalType,l=e.parentName,c=s(e,["components","mdxType","originalType","parentName"]),u=p(r),d=n,g=u["".concat(l,".").concat(d)]||u[d]||m[d]||o;return r?a.createElement(g,i(i({ref:t},c),{},{components:r})):a.createElement(g,i({ref:t},c))}));function d(e,t){var r=arguments,n=t&&t.mdxType;if("string"==typeof e||n){var o=r.length,i=new Array(o);i[0]=u;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s.mdxType="string"==typeof e?e:n,i[1]=s;for(var p=2;p<o;p++)i[p]=r[p];return a.createElement.apply(null,i)}return a.createElement.apply(null,r)}u.displayName="MDXCreateElement"},2068:(e,t,r)=>{r.r(t),r.d(t,{assets:()=>l,contentTitle:()=>i,default:()=>m,frontMatter:()=>o,metadata:()=>s,toc:()=>p});var a=r(7462),n=(r(7294),r(3905));const o={},i="Picture Preprocessing",s={unversionedId:"webdev/pictures",id:"webdev/pictures",title:"Picture Preprocessing",description:"Required Tools",source:"@site/kb/webdev/pictures.mdx",sourceDirName:"webdev",slug:"/webdev/pictures",permalink:"/zh-Hans/kb/webdev/pictures",draft:!1,editUrl:"https://github.com/yechs/website/edit/master/kb/webdev/pictures.mdx",tags:[],version:"current",lastUpdatedAt:1674254922,formattedLastUpdatedAt:"2023\u5e741\u670820\u65e5",frontMatter:{},sidebar:"kbSidebar",previous:{title:"Jenkins CI/CD",permalink:"/zh-Hans/kb/software/jenkins"},next:{title:"Yarn Version Manager",permalink:"/zh-Hans/kb/webdev/yarn"}},l={},p=[{value:"Required Tools",id:"required-tools",level:2},{value:"Convert from heic to jpg",id:"convert-from-heic-to-jpg",level:2},{value:"Rename files",id:"rename-files",level:2},{value:"Purge EXIF and TIFF data",id:"purge-exif-and-tiff-data",level:2},{value:"Responsive Images",id:"responsive-images",level:2},{value:"Compression",id:"compression",level:2}],c={toc:p};function m(e){let{components:t,...r}=e;return(0,n.kt)("wrapper",(0,a.Z)({},c,r,{components:t,mdxType:"MDXLayout"}),(0,n.kt)("h1",{id:"picture-preprocessing"},"Picture Preprocessing"),(0,n.kt)("h2",{id:"required-tools"},"Required Tools"),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",{parentName:"li",href:"https://imagemagick.org"},"ImageMagick")),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",{parentName:"li",href:"https://exiftool.org"},"exiftool")),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",{parentName:"li",href:"https://www.python.org"},"Python 3"),(0,n.kt)("ul",{parentName:"li"},(0,n.kt)("li",{parentName:"ul"},"The ",(0,n.kt)("a",{parentName:"li",href:"https://pypi.org/project/Pillow/"},"Pillow")," library"))),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",{parentName:"li",href:"https://github.com/tjko/jpegoptim"},"jpegoptim")),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",{parentName:"li",href:"https://optipng.sourceforge.net"},"optipng"))),(0,n.kt)("h2",{id:"convert-from-heic-to-jpg"},"Convert from heic to jpg"),(0,n.kt)("p",null,"By default, Apple devices now store pictures in ",(0,n.kt)("a",{parentName:"p",href:"https://en.wikipedia.org/wiki/High_Efficiency_Image_File_Format"},"HEIF format")," (ending in e.g. ",(0,n.kt)("inlineCode",{parentName:"p"},".heic"),").\nHowever, as of now (Jan 2023), no browsers support HEIF (",(0,n.kt)("a",{parentName:"p",href:"https://caniuse.com/heif"},"source"),").\nSo, we have to convert these pictures to a better-supported format. One format is ",(0,n.kt)("a",{parentName:"p",href:"https://en.wikipedia.org/wiki/JPEG"},"jpg"),"."),(0,n.kt)("p",null,"To do so, we use the imagemagick ",(0,n.kt)("a",{parentName:"p",href:"https://imagemagick.org/script/mogrify.php"},"mogrify")," command to convert images to jpg in batch."),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-console"},"magick mogrify -monitor -format jpg *.HEIC\n")),(0,n.kt)("h2",{id:"rename-files"},"Rename files"),(0,n.kt)("p",null,"An optional step is to rename all the files according to the time they are taken. This helps organize the pictures by time."),(0,n.kt)("p",null,"The following command recursively renames all files in the target directory to the format of ",(0,n.kt)("inlineCode",{parentName:"p"},"2022-06/20220602_162412.jpg"),"."),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-console"},"exiftool -r '-FileName<CreateDate' -d '%Y-%m/%Y%m%d_%H%M%S%%-c.%%le' <path/to/target>\n")),(0,n.kt)("p",null,"It is adapted from a ",(0,n.kt)("a",{parentName:"p",href:"https://superuser.com/questions/205417/sort-and-rename-images-by-date-in-exif-info"},"stack exchange post"),"."),(0,n.kt)("h2",{id:"purge-exif-and-tiff-data"},"Purge EXIF and TIFF data"),(0,n.kt)("p",null,"Before uploading your photo, it may contain sensitive EXIF and TIFF data (time taken, device, geo location, ...) that you want to remove.\nYou can use the following ",(0,n.kt)("inlineCode",{parentName:"p"},"exiftool")," command to remove all EXIF and TIFF data of all pictures in current directory."),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-console"},"exiftool -all= .\n")),(0,n.kt)("p",null,"Alternatively, you can also preserve certain fields while removing the rest. For example, the following command preserves the ",(0,n.kt)("inlineCode",{parentName:"p"},"artist")," field."),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-console"},"exiftool -all= -tagsfromfile @ -artist\n")),(0,n.kt)("h2",{id:"responsive-images"},"Responsive Images"),(0,n.kt)("p",null,"In modern web development, the concept of ",(0,n.kt)("a",{parentName:"p",href:"https://developer.mozilla.org/en-US/docs/Learn/HTML/Multimedia_and_embedding/Responsive_images"},"responsive images")," help devices with different screen sizes and resolutions to load only what is necessary."),(0,n.kt)("p",null,"For the gallery of this website, I have written a ",(0,n.kt)("a",{parentName:"p",href:"https://github.com/yechs/website/blob/main/static/img/gallery/srcset.py"},"python script")," to generate responsive images of different widths (1920, 1440, 1024, 640, 320 pixels). These values are inspired from a ",(0,n.kt)("a",{parentName:"p",href:"https://medium.com/hceverything/applying-srcset-choosing-the-right-sizes-for-responsive-images-at-different-breakpoints-a0433450a4a3"},"blog post"),"."),(0,n.kt)("p",null,"Note that the script also removes EXIF and TIFF data. Also, it changes the color profile to sRGB (which may originally be Display P3 for iOS devices)."),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-console"},"python srcset.py\n")),(0,n.kt)("h2",{id:"compression"},"Compression"),(0,n.kt)("p",null,"It is also important to compress all images so they take less time to load and save bandwidth."),(0,n.kt)("p",null,"The following command optimizes all JPEG images. Although for most cases progressive images take less space, it may also be possible that a normal image takes less space. So you may want to run the command twice."),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-console"},'jpegoptim -s --all-progressive ./*.jpg")\njpegoptim -s --all-normal ./*.jpg")\n\n')),(0,n.kt)("p",null,"For png files, you may use ",(0,n.kt)("a",{parentName:"p",href:"https://optipng.sourceforge.net"},"optipng"),"."))}m.isMDXComponent=!0}}]);